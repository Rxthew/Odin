import { DOMGeneral } from "./helpers/DOM";
import { projectEvents } from "./projectevents";


export const templateDOMStructs = function (){

    const DOM = DOMGeneral()
    const delegator = projectEvents.delegator

    const createProject = function(name){
         const reference = DOM.selectElem('.project'); 
         const proj = DOM.elementInit('div',{'id': `${name}${reference.length}`,
                                             'data-id':`${reference.length}`, 
                                             'class': 'project'},name
                                             )
        const viewProjectBtn = DOM.elementInit('button', {'class': 'viewProject'}, 'View Inside');
        const addToDoListBtn = DOM.elementInit('button', {'class': 'addtoDoList',
                                                           'id': `add${DOM.selectElem('.project').length}`}, 'Add To-Do List');
        proj.appendChild(viewProjectBtn);
        proj.appendChild(DOM.elementInit('div',{ 'class':'none',
                                                   'id':`container${reference.length}`}));
        proj.appendChild(addToDoListBtn);

        
        proj.onclick = delegator;
                                                                      
        const container = DOM.selectElem('#container');
        container.appendChild(proj);
        
        return proj

     }
     

     const createToDoNote = function(chosenType){
        const input = DOM.selectElem('#temporaryInput') 
        const project = input.parentElement;
        const formReference = DOM.selectElem('.toDoNoteInput')
        const container = DOM.selectElem(`#container${project.dataset.id}`);
        
        const form = DOM.elementInit('form',{'class': 'toDoNoteInput',
                                                 'id': `toDoNoteForm${project.dataset.id}${formReference.length}`,
                                                  'data-id':`${formReference.length}` })
        const submit = DOM.elementInit('button',{'type':'submit',
                                                   'id': 'submitNote', 
                                                  'class':'submitNote none',
                                                   },'Submit Note')
        const remove = DOM.elementInit('button', {'class':'remove none',
                                                   'id':`remove${project.dataset.id}${formReference.length}`}, 'X');

        
        form.appendChild(submit);
        form.appendChild(remove);
        

        input.oninput = delegator;
        form.onsubmit = delegator;   
         
        container.classList.toggle('none', false);
        
         
        container.appendChild(form);

        const _generateChecklist = function(){ 
           const add = DOM.elementInit('button', {'class':'addCheck',
                                                     'id':'addCheck',
                                                     }, 'Add Item');
            const cancel = DOM.elementInit('button', {'class':'cancel none',
                                                     'id':'cancel'}, 'Cancel Note');
                                                     
            form.appendChild(add);
            form.appendChild(cancel);

            form.classList.add('checkbox')
       }

       const _generateFreeForm = function(){

        input.value = '';
        input.classList.toggle('none',false);
        form.classList.add('freeForm')
        
       }

       chosenType === 'Checklist' ? _generateChecklist() : _generateFreeForm();  

       return 

     }

     const modifyToDoNote = function(event){
         
         event.preventDefault();
         
         const modInput = DOM.elementInit('input',{'type':'text',
         'autocomplete':'off',
         'required':'required',
         'class': 'modInput'});
         const submit = DOM.elementInit('button',{'type':'submit',
        'class':'submitMod',
         },'Submit Note')
         const revert = DOM.elementInit('button',{
         'class':'revertMod',
         'data-transfer':`${event.target.parentElement.firstChild.nodeValue}` //temporary, update to use local storage & backend
          },'Revert Back') 
         
         const _disableAllOtherBtns = (function(){
             const all = document.querySelectorAll('button');
             all.forEach(btn => btn.disabled = true);
         })()

         const _replaceWithInput = (function(){
             modInput.value = event.target.parentElement.firstChild.nodeValue; 
             event.target.parentElement.replaceWith(modInput);
             modInput.insertAdjacentElement('afterend',submit);
             submit.insertAdjacentElement('afterend',revert);
        })() 
         
        return   

     }

     const submitModifiedNote = function(event){
        
        event.preventDefault();
        const form = event.target.parentElement;
        const input = event.target.previousElementSibling;
        const revert = event.target.nextElementSibling;
        const label = DOM.elementInit('label', {'for': `${input.value}`},`${input.value}`);
        const text = DOM.elementInit('p', {'class':'text'}, `${input.value}`);
        const modify = DOM.elementInit('button', {'class':'edit'},
        'Edit');        

        if(form.classList.contains('checkbox')){
            label.appendChild(modify);
            input.replaceWith(label);

        }
        else{
            text.appendChild(modify);
            input.replaceWith(text); 
        }
         
        const _enableAllOtherBtns = (function(){
            const all = document.querySelectorAll('button');
            all.forEach(btn => btn.disabled = false);
        })()
    
        revert.remove();
        event.target.remove()


        return         
     }

     const revertModifiedNote = function(event){
        
        event.preventDefault();
        const form = event.target.parentElement;
        const submit = event.target.previousElementSibling;
        const input = submit.previousElementSibling;
        const label = DOM.elementInit('label', {'for': `${event.target.dataset.transfer}`},`${event.target.dataset.transfer}`); //temporary, update to use local storage & backend
        const text = DOM.elementInit('p', {'class':'text'}, `${event.target.dataset.transfer}`); //temporary, update to use local storage & backend
        const modify = DOM.elementInit('button', {'class':'edit'},
        'Edit');        

        if(form.classList.contains('checkbox')){
            label.appendChild(modify);
            input.replaceWith(label);

        }
        else{
            text.appendChild(modify);
            input.replaceWith(text); 
        }
         
        const _enableAllOtherBtns = (function(){
            const all = document.querySelectorAll('button');
            all.forEach(btn => btn.disabled = false);
        })()
    
        submit.remove();
        event.target.remove()


        return         
     }     


     const chooseNoteType = function(event){
        const domProject = event.target.parentElement;

        if (domProject.lastElementChild.className === 'chooseNoteType') {
            return
        }

         const form =  DOM.elementInit('form', {'class': 'chooseNoteType',
                                                    'id': 'noteTypeForm'                      })
         const label = DOM.elementInit('label',{'for':'chooseNoteType'},'Choose Your Note Type');
         const select = DOM.elementInit('select',{'class':'select',
                                                    'id': 'select' });
         const optGroup = DOM.elementInit('optgroup',{'label': 'Note Options'}, 'Choose your note type');
         const checklistOpt = DOM.elementInit('option',{'name': 'checklist',
                                                         'class': 'checklist'},'Checklist');
         const inputOpt = DOM.elementInit('option',{'name': 'input',
                                                     'class': 'input'},'Freeform');
         const choice = DOM.elementInit('button', {'type':'submit'}, 'Submit');
         
         select.appendChild(optGroup);
         optGroup.appendChild(checklistOpt);
         optGroup.appendChild(inputOpt);
         form.appendChild(label);
         form.appendChild(select);
         form.appendChild(DOM.elementInit('br'));
         form.appendChild(choice);

         
         form.onsubmit = delegator;
         domProject.appendChild(form);

         return form
 }
     
     const revealCreateForm = function(){
        let hidden = DOM.selectElem('#createForm');
        hidden.classList.toggle('hidden', false);
        
     }

     const toggleProjectSize = function(event){
            event.target.nextElementSibling.classList.toggle('none');
     }

     const noteTypeGenerator = function(){

        const getSelected = (function(){
             const select =  DOM.selectElem('#select');
             return select.options[select.selectedIndex].value;
        })()
        
        const generateTemporaryInput = (function(){
            const project = DOM.selectElem('#noteTypeForm').parentElement;
            const temporaryInput = DOM.elementInit('input',{'type':'text',
            'autocomplete':'off',
            'required':'required',
            'id':'temporaryInput',
           'class': 'temporaryInput none'});  
            project.appendChild(temporaryInput);      
        })()
        
        projectEvents.publish('deleteNoteTypeForm');
        projectEvents.publish('createNote', getSelected);


        //remember createnote thing will apply to the backend as well,
        // so when you pass in that argument, that's when the 'type'
        // of the note will be stored in there. 
        
        
        return getSelected
     }



    const deleteAddNoteForm = function(){
         const deleted = DOM.selectElem('#noteTypeForm');
         deleted.remove();
    }

    const disableBtns = function(){
        const  project = DOM.selectElem('#temporaryInput').parentElement;

        const addtoDoButton = DOM.selectElem(`#add${project.dataset.id}`);
        const newProjectButton = DOM.selectElem('#submit');

        addtoDoButton.disabled = true;
        newProjectButton.disabled = true;
        return 
     }

    const cleanToDoForm = function(){
        let deleted = DOM.selectElem('#temporaryInput');
        deleted.remove();

        deleted = DOM.selectElem('#submitNote');
        deleted.remove()

        deleted = DOM.selectElem('#addCheck');
        deleted ? deleted.remove(): false

        deleted = DOM.selectElem('#cancel');
        deleted ? deleted.remove(): false

        return

    }

    const enableBtns = function(event){

     const project = event.target.parentElement.parentElement.parentElement;
     const form = DOM.selectElem('#submitNote').parentElement;
     //const remove = DOM.selectElem(`#remove${project.dataset.id}${form.dataset.id}`)

     const addtoDoButton = DOM.selectElem(`#add${project.dataset.id}`);
     const newProjectButton = DOM.selectElem('#submit');
     const modifyBtns = DOM.selectElem('.edit');

     addtoDoButton.disabled = false;
     newProjectButton.disabled = false;
     modifyBtns.forEach(btn => btn.classList.toggle('none',false));

     

     return

    }
    
    const checkContent = function(){

        const input = DOM.selectElem('#temporaryInput');
        const submit = DOM.selectElem('#submitNote');
        const form = submit.parentElement;
        const add = DOM.selectElem('#addCheck');
        const cancel = DOM.selectElem('#cancel');
          

        if (form.classList.contains('checkbox')){     
             if (input.value === ''){
                 add.disabled = true;
                 cancel.classList.toggle('none',false); 
            }
            else {
                 add.disabled = false
                 cancel.classList.toggle('none', true);
                 submit.classList.toggle('none',true);
            }

            return
        }
        
        else { 
              submit.classList.toggle('none',false);
              
        }
    }

    const cancelNote = function(event){

        const add = DOM.selectElem('#addCheck');
        const input = DOM.selectElem('#temporaryInput');
        const cancel = DOM.selectElem('#cancel');
        const project = input.parentElement;
        const container = DOM.selectElem(`#container${project.dataset.id}`);

        cancel.classList.toggle('none',true);
        input.value = '';
        container.classList.toggle('none',true);
        input.classList.toggle('none',true);
        
        add.textContent = 'Add Item';
        add.disabled = false;
        
        return        
    }


     const submitCheck = function(event){
        event.preventDefault();
        const add = DOM.selectElem('#addCheck');
        const input = DOM.selectElem('#temporaryInput');                     
        const submit = DOM.selectElem('#submitNote');
        const form = submit.parentElement;
        const remove = DOM.selectElem(`#remove${input.parentElement.dataset.id}${form.dataset.id}`)

        if (input.value === '' && add.textContent === 'Submit Item'){
            add.textContent = 'Add Item';
            input.classList.toggle('none',true)
            return
        }

        else if (add.textContent === 'Submit Item'){
            _generateCheckItem();
            submit.classList.toggle('none',false);
            remove.classList.toggle('none',false);
            input.classList.toggle('none', true);
            add.textContent = 'Add Item';
        }
        else {
            input.classList.toggle('none',false);
            add.textContent = 'Submit Item'
            }                         
        }
    
      const _generateCheckItem = function(){
        const input = DOM.selectElem('#temporaryInput');
        const form = DOM.selectElem('#submitNote').parentElement;
        const modify = DOM.elementInit('button', {'class':'edit none'},
        'Edit');
       
        const checkbox = DOM.elementInit('input', {'type':'checkbox'});
        const label = DOM.elementInit('label', {'for': `${input.value}`},`${input.value}`);
        const br = DOM.elementInit('br');

        input.value = '';
        label.appendChild(modify);
        form.appendChild(checkbox);
        form.appendChild(label);
        form.appendChild(br);
        return
    }

    const submitTextItem = function(){
    
    const input = DOM.selectElem('#temporaryInput');
    const form = DOM.selectElem('#submitNote').parentElement;
    const remove = DOM.selectElem(`#remove${input.parentElement.dataset.id}${form.dataset.id}`);
    const modify = DOM.elementInit('button', {'class':'edit'},
    'Edit');


    if (form.classList.contains('checkbox')){
        return
    }
    
    const text = DOM.elementInit('p', {'class':'text'}, `${input.value}`);
    text.appendChild(modify);
    form.appendChild(text);
    remove.classList.toggle('none',false);

    return
    
    }
     return {
         createProject,
         createToDoNote,
         revealCreateForm,
         toggleProjectSize,
         chooseNoteType,
         noteTypeGenerator,
         deleteAddNoteForm,
         disableBtns,
         enableBtns,
         cleanToDoForm,
         checkContent,
         modifyToDoNote,
         cancelNote,
         revertModifiedNote,
         submitCheck,
         submitTextItem,
         submitModifiedNote
     }
}